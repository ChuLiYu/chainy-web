<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>響應式 Google 登錄測試</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        h1 {
            text-align: center;
            color: #4285f4;
            margin-bottom: 30px;
        }

        .device-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #4285f4;
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }

        .test-button {
            width: 100%;
            padding: 12px 16px;
            background: #4285f4;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
            transition: background 0.3s;
        }

        .test-button:hover {
            background: #3367d6;
        }

        .log {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>🚀 響應式 Google 登錄測試</h1>

        <div class="device-info">
            <h3>📱 設備資訊</h3>
            <div id="device-info">檢測中...</div>
        </div>

        <div class="test-section">
            <h3>🔧 Google Auth 配置</h3>
            <div id="config-info">載入中...</div>
        </div>

        <div class="test-section">
            <h3>🧪 測試功能</h3>
            <button class="test-button" onclick="testDeviceDetection()">檢測設備類型</button>
            <button class="test-button" onclick="testGoogleAuthInit()">初始化 Google Auth</button>
            <button class="test-button" onclick="testGoogleLogin()">觸發 Google 登錄</button>
            <button class="test-button" onclick="clearLog()">清除日誌</button>
        </div>

        <div class="test-section">
            <h3>📊 測試結果</h3>
            <div id="status"></div>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script>
        // 模擬 googleAuth.js 的功能
        const GOOGLE_CLIENT_ID = '1079648073253-kueo7mpri415h10dsc0fldeoecp878l6.apps.googleusercontent.com';

        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;

            // 更新狀態
            const statusElement = document.getElementById('status');
            statusElement.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function getDeviceType() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isTablet = /iPad|Android/i.test(navigator.userAgent) && window.innerWidth >= 768;
            const isDesktop = !isMobile && !isTablet;

            return { isMobile, isTablet, isDesktop };
        }

        function getOptimalUxMode() {
            const { isMobile, isTablet } = getDeviceType();
            return (isMobile || isTablet) ? 'redirect' : 'popup';
        }

        function getButtonConfig() {
            const { isMobile } = getDeviceType();

            return {
                theme: 'outline',
                size: 'large',
                text: 'signin_with',
                shape: 'rectangular',
                width: '100%',
                logo_alignment: 'left'
            };
        }

        function testDeviceDetection() {
            const deviceType = getDeviceType();
            const uxMode = getOptimalUxMode();
            const buttonConfig = getButtonConfig();

            log(`設備檢測結果:`, 'info');
            log(`- 移動端: ${deviceType.isMobile}`, 'info');
            log(`- 平板: ${deviceType.isTablet}`, 'info');
            log(`- 桌面端: ${deviceType.isDesktop}`, 'info');
            log(`- 螢幕寬度: ${window.innerWidth}px`, 'info');
            log(`- 建議UX模式: ${uxMode}`, 'info');
            log(`- 按鈕配置: ${JSON.stringify(buttonConfig)}`, 'info');

            // 更新設備資訊顯示
            document.getElementById('device-info').innerHTML = `
                <strong>設備類型:</strong> ${deviceType.isMobile ? '移動端' : deviceType.isTablet ? '平板' : '桌面端'}<br>
                <strong>螢幕寬度:</strong> ${window.innerWidth}px<br>
                <strong>建議UX模式:</strong> ${uxMode}<br>
                <strong>User Agent:</strong> ${navigator.userAgent.substring(0, 50)}...
            `;
        }

        function testGoogleAuthInit() {
            log('開始初始化 Google Auth...', 'info');

            if (!GOOGLE_CLIENT_ID) {
                log('❌ Google Client ID 未配置', 'error');
                return;
            }

            const uxMode = getOptimalUxMode();
            const deviceType = getDeviceType();

            log(`✅ Client ID: ${GOOGLE_CLIENT_ID}`, 'success');
            log(`✅ 設備類型: ${JSON.stringify(deviceType)}`, 'success');
            log(`✅ UX模式: ${uxMode}`, 'success');

            const config = {
                client_id: GOOGLE_CLIENT_ID,
                callback: 'handleGoogleResponse',
                auto_select: false,
                cancel_on_tap_outside: true,
                use_fedcm_for_prompt: false,
                ux_mode: uxMode
            };

            if (uxMode === 'redirect') {
                config.redirect_uri = 'http://localhost:3000/callback';
            }

            log(`✅ 配置: ${JSON.stringify(config, null, 2)}`, 'success');

            // 更新配置資訊
            document.getElementById('config-info').innerHTML = `
                <strong>Client ID:</strong> ${GOOGLE_CLIENT_ID}<br>
                <strong>UX模式:</strong> ${uxMode}<br>
                <strong>重定向URI:</strong> ${uxMode === 'redirect' ? 'http://localhost:3000/callback' : '無'}<br>
                <strong>配置狀態:</strong> <span style="color: green;">✅ 就緒</span>
            `;
        }

        function testGoogleLogin() {
            log('觸發 Google 登錄測試...', 'info');

            const uxMode = getOptimalUxMode();
            log(`使用 ${uxMode} 模式`, 'info');

            if (uxMode === 'popup') {
                log('桌面端模式: 嘗試 One Tap 彈窗', 'info');
                log('如果 One Tap 不顯示，將使用 Sign-In Button', 'info');
            } else {
                log('移動端模式: 將重定向到 Google 授權頁面', 'info');
            }

            // 模擬登錄流程
            setTimeout(() => {
                log('✅ Google 登錄流程已觸發', 'success');
                log('請檢查瀏覽器是否跳轉到 Google 授權頁面', 'info');
            }, 1000);
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
            document.getElementById('status').innerHTML = '';
        }

        // 頁面載入時自動檢測
        window.onload = function () {
            testDeviceDetection();
            testGoogleAuthInit();
            log('🚀 響應式 Google 登錄測試頁面已載入', 'success');
        };

        // 處理 Google 登錄回應
        function handleGoogleResponse(response) {
            log('收到 Google 登錄回應:', 'success');
            log(`回應: ${JSON.stringify(response)}`, 'info');
        }

        // 監聽視窗大小變化
        window.addEventListener('resize', function () {
            log(`視窗大小變化: ${window.innerWidth}x${window.innerHeight}`, 'info');
            testDeviceDetection();
        });
    </script>
</body>

</html>
